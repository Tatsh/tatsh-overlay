--- a/setup.py
+++ b/setup.py
@@ -7,6 +7,7 @@ import os
 import re
 import ast
 import glob
+import shlex
 import shutil
 from pathlib import Path
 from packaging.version import parse, Version
@@ -249,7 +250,7 @@ if not SKIP_CUDA_BUILD and not IS_ROCM:
         torch._C._GLIBCXX_USE_CXX11_ABI = True
 
     nvcc_flags = [
-    "-O3",
+    *shlex.split(os.getenv("NVCC_FLAGS", "-O2")),
     "-std=c++17",
     "-U__CUDA_NO_HALF_OPERATORS__",
     "-U__CUDA_NO_HALF_CONVERSIONS__",
@@ -269,7 +270,7 @@ if not SKIP_CUDA_BUILD and not IS_ROCM:
     # "-DFLASHATTENTION_DISABLE_LOCAL",
     ]
 
-    compiler_c17_flag=["-O3", "-std=c++17"]
+    compiler_c17_flag=[*shlex.split(os.getenv("CXXFLAGS", "-O2")), "-std=c++17"]
     # Add Windows-specific flags
     if sys.platform == "win32" and os.getenv('DISTUTILS_USE_SDK') == '1':
         nvcc_flags.extend(["-Xcompiler", "/Zc:__cplusplus"])
